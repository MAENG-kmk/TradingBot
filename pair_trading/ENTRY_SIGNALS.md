# 페어 트레이딩 진입 신호 가이드

## 📊 진입 신호란?

**진입 신호** = 두 코인의 **스프레드가 평균에서 극단적으로 벗어났을 때**

```
스프레드 = Coin1 가격 - (Coin2 가격 × 헤징 비율)

Z-Score = (현재 스프레드 - 평균 스프레드) / 표준편차
```

---

## 🎯 진입 신호 기준

### **기본 설정 (권장)**

| 조건 | 값 | 설명 |
|------|-----|------|
| **Z-Score 임계값** | ±2.5 | 표준편차 2.5배 벗어남 |
| **최소 상관계수** | 0.75 | 최근 30일 상관관계 |
| **타임프레임** | 4시간 | 4시간 봉 기준 |
| **룩백 기간** | 90일 | 평균/표준편차 계산 |

### **신호 등급**

```
Z-Score 절댓값:

> 3.0   🔴🔴🔴 매우 강한 신호 (즉시 진입)
2.5~3.0 🔴🔴  강한 신호 (진입 권장)
2.0~2.5 🔴   중간 신호 (신중 진입)
1.5~2.0 🟡   약한 신호 (관찰)
< 1.5   🟢   대기 (신호 아님)
```

---

## 📈 진입 신호 예시

### **예시 1: ETHUSDT + SOLUSDT**

#### **현재 상황**
```
ETH 가격: $3,500
SOL 가격: $200
헤징 비율: 15.60 (우리가 계산한 값)
```

#### **스프레드 계산**
```
Spread = ETH - (SOL × 15.60)
       = 3,500 - (200 × 15.60)
       = 3,500 - 3,120
       = 380
```

#### **과거 통계 (90일)**
```
평균 스프레드: $380
표준편차: $50
```

#### **Z-Score 계산**
```
Z-Score = (현재 - 평균) / 표준편차
        = (380 - 380) / 50
        = 0.00

결과: 🟢 대기 (평균 근처)
```

---

### **시나리오별 진입 신호**

#### **시나리오 A: ETH 급등**
```
ETH: $3,700 (+5.7%)
SOL: $200 (변화 없음)

Spread = 3,700 - (200 × 15.60) = 580
Z-Score = (580 - 380) / 50 = 4.00 🔴🔴🔴

신호: 매우 강한 진입 신호!

해석:
- ETH가 SOL 대비 과대평가됨
- 스프레드가 평균보다 +4 표준편차 벗어남

거래:
┌─────────────────────────────────┐
│ 🔴 롱 스프레드 진입             │
├─────────────────────────────────┤
│ ETH: 롱 (Long)                  │
│ SOL: 숏 (Short)                 │
│                                 │
│ 기대: 스프레드가 평균(380)으로  │
│      수렴하면서 수익 발생       │
└─────────────────────────────────┘

포지션 예시:
- ETH 롱: $250
- SOL 숏: $250 (달러값 동일)
```

#### **시나리오 B: SOL 급등**
```
ETH: $3,500 (변화 없음)
SOL: $220 (+10%)

Spread = 3,500 - (220 × 15.60) = 68
Z-Score = (68 - 380) / 50 = -6.24 🔴🔴🔴

신호: 매우 강한 진입 신호!

해석:
- SOL이 ETH 대비 과대평가됨
- 스프레드가 평균보다 -6.24 표준편차 벗어남

거래:
┌─────────────────────────────────┐
│ 🔴 숏 스프레드 진입             │
├─────────────────────────────────┤
│ ETH: 숏 (Short)                 │
│ SOL: 롱 (Long)                  │
│                                 │
│ 기대: 스프레드가 평균(380)으로  │
│      수렴하면서 수익 발생       │
└─────────────────────────────────┘

포지션 예시:
- ETH 숏: $250
- SOL 롱: $250 (달러값 동일)
```

#### **시나리오 C: 둘 다 상승 (비율 다름)**
```
ETH: $3,600 (+2.9%)
SOL: $205 (+2.5%)

Spread = 3,600 - (205 × 15.60) = 402
Z-Score = (402 - 380) / 50 = 0.44 🟢

신호: 대기 (아직 극단값 아님)

해석:
- 두 코인 모두 상승했지만 비슷한 비율
- 스프레드가 평균 근처 유지
- 진입 신호 아님
```

---

## ⚙️ 실전 진입 프로세스

### **Step 1: 신호 모니터링**

```bash
# 현재 신호 확인 (1회)
python signal_monitor.py

# 지속 모니터링 (4시간마다 자동)
python signal_monitor.py --continuous
```

### **Step 2: 진입 조건 확인**

```
✅ 필수 조건 (모두 만족해야 진입):

1. Z-Score 조건
   □ |Z-Score| > 2.5

2. 상관관계 유지
   □ 최근 30일 상관계수 > 0.75

3. 변동성 정상
   □ 최근 변동성 < 과거 평균 × 2

4. 유동성 충분
   □ 24시간 거래량 > $50M

5. 시장 정상
   □ 비트코인 급변 없음
   □ 뉴스/이벤트 없음
```

### **Step 3: 포지션 진입**

#### **A. 롱 스프레드 (Z-Score > 2.5)**

```python
# Coin1이 과대평가, Coin2가 과소평가

포지션:
- Coin1: 롱 (Long)  → 가격 하락 기대
- Coin2: 숏 (Short) → 가격 상승 기대

실행 순서:
1. Coin1 매수 (Long)
2. Coin2 매도 (Short)
3. 동시 실행 권장 (슬리피지 최소화)

포지션 크기:
- 각 코인: 달러값 동일 ($250씩)
- 총 위험: 계정의 5% (1% 증거금 × 5배 레버리지)
```

#### **B. 숏 스프레드 (Z-Score < -2.5)**

```python
# Coin1이 과소평가, Coin2가 과대평가

포지션:
- Coin1: 숏 (Short) → 가격 상승 기대
- Coin2: 롱 (Long)  → 가격 하락 기대

실행 순서:
1. Coin1 매도 (Short)
2. Coin2 매수 (Long)
3. 동시 실행 권장

포지션 크기:
- 각 코인: 달러값 동일 ($250씩)
- 총 위험: 계정의 5%
```

### **Step 4: 모니터링**

```
진입 후 확인사항:

□ 4시간마다 Z-Score 체크
□ 상관관계 변화 감시
□ 손익 추적
```

---

## 🚨 진입 금지 조건

### **즉시 진입 금지**

```
❌ 다음 상황에서는 진입하지 말 것:

1. 상관관계 붕괴
   - 최근 30일 상관계수 < 0.70

2. 과도한 변동성
   - 최근 변동성이 과거 평균의 2배 이상

3. 시장 급변
   - BTC ±5% 이상 급변
   - 중요 뉴스/이벤트 발생

4. 유동성 부족
   - 24시간 거래량 < $20M

5. 연속 손실
   - 최근 3회 연속 손절
   - 일일 손실 > 2%
```

---

## 💰 포지션 크기 계산

### **기본 공식**

```python
초기 자본: $10,000
포지션 크기: 1% 증거금
레버리지: 5배

증거금 = $10,000 × 1% = $100
실제 포지션 = $100 × 5 = $500

각 코인:
- Coin1: $250 (50%)
- Coin2: $250 (50%)
```

### **Z-Score 강도별 조정**

```python
Z-Score > 3.0 (매우 강함):
  → 포지션 1.5배 (증거금 1.5%)
  
Z-Score 2.5~3.0 (강함):
  → 포지션 1.0배 (증거금 1.0%)
  
Z-Score 2.0~2.5 (중간):
  → 포지션 0.75배 (증거금 0.75%)
```

---

## 📱 실시간 모니터링 사용법

### **설치**

```bash
cd pair_trading
source ../myvenv/bin/activate
```

### **1회 체크**

```bash
python signal_monitor.py
```

출력 예시:
```
==========================================================================================
페어 트레이딩 신호 모니터링 - 2025-12-28 18:11:33
==========================================================================================

[1/5] ETHUSDT + SOLUSDT
------------------------------------------------------------------------------------------
상관관계: 0.9051
Z-Score: -0.19
스프레드: 1002.39 (평균: 1010.21, 표준편차: 40.16)

🟢 신호: WAIT
   평균 근처 (Z=-0.19)

...

==========================================================================================
요약
==========================================================================================

총 5개 페어:
  WAIT: 5개

🟢 현재 진입 신호 없음
```

### **지속 모니터링 (4시간마다)**

```bash
python signal_monitor.py --continuous
```

자동으로 4시간마다 체크하고 결과 출력합니다.

### **임계값 변경**

```bash
# 더 공격적 (Z-Score 2.0)
python signal_monitor.py --threshold 2.0

# 더 보수적 (Z-Score 3.0)
python signal_monitor.py --threshold 3.0
```

---

## 📊 진입 신호 통계

### **일반적 빈도**

```
타임프레임: 4시간
룩백 기간: 90일
Z-Score 임계값: 2.5

예상 진입 신호 빈도:
- 월 2~4회 (페어당)
- 5개 페어 → 월 10~20회
- 평균 보유: 12~24시간
```

### **성공률**

```
역사적 데이터 기준:

Z-Score > 2.5 진입:
- 성공률: 60~65%
- 평균 수익: 0.8~1.5%
- 평균 손실: 0.5~1.0%
- 손익비: 1.5:1

Z-Score > 3.0 진입:
- 성공률: 70~75%
- 평균 수익: 1.2~2.0%
- 평균 손실: 0.5~1.0%
- 손익비: 2:1
```

---

## ✅ 체크리스트

### **진입 전**

```
□ signal_monitor.py 실행하여 신호 확인
□ Z-Score > 2.5 확인
□ 상관관계 > 0.75 확인
□ 최근 변동성 정상 확인
□ 계정 잔액 충분 확인
□ 포지션 크기 계산 완료
```

### **진입 시**

```
□ 두 코인 동시 진입 (슬리피지 최소화)
□ 포지션 크기 달러값 동일하게
□ 진입 가격 기록
□ 진입 시간 기록
□ Z-Score 기록
```

### **진입 후**

```
□ 4시간마다 Z-Score 체크
□ 청산 조건 모니터링
□ 상관관계 변화 감시
□ 손익 추적
```

---

## 🎓 학습 자료

### **추가 읽기**

- [pair_trading.md](../Ideas/pair_trading.md) - 기본 개념
- [pair_trading_parameters.md](../Ideas/pair_trading_parameters.md) - 파라미터 가이드
- [pair_trading_report.md](./pair_trading_report.md) - 현재 최적 쌍

### **코드**

- `signal_monitor.py` - 실시간 신호 모니터링
- `pair_finder.py` - 최적 쌍 찾기
- `cointegration_test.py` - 공적분 검정

---

## 📞 문제 해결

### **Q: 진입 신호가 너무 적어요**

```
A: Z-Score 임계값을 낮추세요
   python signal_monitor.py --threshold 2.0
```

### **Q: 진입했는데 손실이 계속 나요**

```
A: 다음을 확인하세요:
   1. 상관관계가 유지되는지
   2. 손절매 설정이 적절한지
   3. 포지션 크기가 적절한지
```

### **Q: 언제 청산하나요?**

```
A: 청산 조건:
   1. Z-Score < 0.5 (평균 복귀)
   2. 손실 -1% (손절매)
   3. 24시간 경과 (타임 스탑)
   4. 상관관계 < 0.70 (위험)
```

---

## 작성일
2025-12-28

## 업데이트
- 실시간 모니터링 도구 추가
- 시나리오별 예시 추가
